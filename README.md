![ghidra_MCP_logo](images/ghidraMCPd.png)

# GhidraMCPd - token-efficient MCP server for Ghidra

Deterministic MCP server for the Ghidra plugin focused on lowering token spend while keeping schemas stable and auditable.

> **âš ï¸ AI-Generated Code:** This repository's code is almost entirely generated by AI assistants (Codex, AiderDesk). Human role: architecture, planning, review, testing, and documentation. Use at your own risk.
>
> **Status:** Experimental â€¢ **License:** Apache 2.0  
> **Credit:** Fork of **GhidraMCP** - thanks to **Laurie Wired** for the original project.

## Motivation

Started as a side-quest while building an e-recumbent bike battery (needed to label matched cells â†’ bought a Chinese handheld HP45 printer â†’ found SD card â†’ firmware RE â†’ here we are ðŸš´).

Bridging Ghidra through MCP can be API-expensive when clients emit many small calls. Ghidra MCPd reduces this through:
- **Batch operations**: `disassemble_batch`, `read_words` - analyze multiple addresses in one call
- **Server-side context**: `search_scalars_with_context` - includes surrounding disassembly
- **Efficient pagination**: Resume cursors and deterministic limits

Token savings depend on workflow, but batching operations significantly reduces round-trips and response overhead.

## Highlights

* Batch Ops: `disassemble_batch`, `read_words`, and the powerful `collect` endpoint.
* Contextual Search: `search_scalars_with_context` provides server-side disassembly windows.
* Deterministic Envelopes & Schemas: All responses follow a strict `{ok, data, errors[]}` structure with `additionalProperties:false`.
* Guard Rails: Write operations are disabled by default (`ENABLE_WRITES`, `dry_run`), with safety limits and observability via `/state`
* Tested: Includes contract, golden (OpenAPI/HTTP parity), and unit tests to prevent drift.

## Quickstart

```bash
python -m venv .venv
source .venv/bin/activate
python -m pip install -r requirements.txt -r requirements-dev.txt
uvicorn bridge.app:create_app --factory --host 127.0.0.1 --port 8000
```

Once running, open Ghidra with a project and the server will connect automatically.

### Legacy / stdio mode

Need a console-first workflow or migrating from the original bridge helper? Run the
legacy entry point instead of Uvicorn:

```bash
python scripts/bridge_stdio.py --transport stdio
```

This launches the MCP server directly over stdio (no `/sse` endpoint or OpenWebUI
shim). Use it when testing locally without a browser client or when you need to
mimic the pre-shim behavior; otherwise prefer the SSE server above so modern
clients can attach via `/sse` and `/messages`.
==== BASE ====

## MCP Clients

Theoretically, any MCP client should work with ghidraMCPd.  Three examples are given below.

## Example 1: AiderDesk
To set up AiderDesk as a Ghidra MCPd client, go to `Settings` -> `Agent` -> `MCP Servers (Agent Settings)` -> `Add`/`Edit Config` and add the following:

```json
{
  "mcpServers": {
    "ghidra-bridge": {
      "name": "Ghidra Bridge",
      "type": "sse",
      "url": "http://127.0.0.1:8000/sse"
    }
  }
}
```

## Example Usage

```bash
# Find all functions using MMIO address 0x40000000
curl -X POST http://localhost:8000/api/collect.json \
  -H 'content-type: application/json' \
  -d '{
        "queries": [
          {
            "id": "mmio-usages",
            "op": "search_scalars_with_context",
            "params": {"value": "0x40000000", "context_lines": 2, "limit": 10}
          }
        ]
      }'

# Analyze function with decompiler
curl -X POST http://localhost:8000/api/analyze_function_complete.json \
  -H 'content-type: application/json' \
  -d '{"address":"0x1000","fields":["function","decompile","xrefs"]}'
```

## Build the Ghidra extension

Populate `lib/` with the required Ghidra jars, then run Maven:

```bash
python scripts/fetch_ghidra_jars.py
mvn -DskipTests package
```

If you already have a local Ghidra checkout, you can still point Maven at it directly:

```bash
export GHIDRA_DIR=/path/to/ghidra_*_PUBLIC && mvn -DskipTests package
```

The build produces `target/GhidraMCP-1.0-SNAPSHOT.jar`.

**Installation:**

1. a) Copy the JAR to Ghidra's Extensions directory:
      ```bash
      cp target/GhidraMCP-1.0-SNAPSHOT.jar $GHIDRA_INSTALL_DIR/Extensions/Ghidra/
      ```

   b) Use Ghidra's GUI: **File â†’ Install Extensions** and select the JAR file.

2. Restart Ghidra to load the extension.

3.  **Activate:** After restarting, go to **File â†’ Configure â†’ Developer/Configure**. Find `GhidraMCP` in the list (usually under the "Analysis" category) and **check the box** next to it to enable it. The plugin will not be active until you do this.

## Advanced start

Run the server and verify deterministic behavior:

```bash
curl -sS http://localhost:8000/openapi.json | jq '.info.title'
# â†’ 200 JSON ("Ghidra MCP Bridge API")

curl -iN http://localhost:8000/sse
# keep this stream open (HTTP/1.1 200)

curl -i http://localhost:8000/sse
# â†’ HTTP/1.1 409 Conflict (single active SSE)

curl -i -X POST http://localhost:8000/sse
# â†’ HTTP/1.1 405 Method Not Allowed + {"allow":"GET"}

curl -i http://localhost:8000/messages
# before readiness â†’ HTTP/1.1 425 Too Early + {"error":"mcp_not_ready"}

curl -sS -X POST http://localhost:8000/api/write_bytes.json \
  -H 'content-type: application/json' \
  -d '{"address":"0x00400000","data":"AAEC","dry_run":true}'
# â†’ {"ok":true,"data":{"written":false,...,"notes":["dry-run enabled: no bytes written", ...]},"errors":[]}
```

### Legacy / stdio mode

When running `python scripts/bridge_stdio.py --transport stdio` the checks above
change slightly:

- There is no `/sse` routeâ€”clients speak MCP over stdio and log readiness when the
  bridge emits its `Initialized` notification.
- `/messages` and `/state` are only available in the SSE topology. For stdio,
  watch the console logs for `MCP INITIALIZED` before issuing tool calls.

Use stdio when you need deterministic CLI sessions or compatibility with older
MCP shells. Return to the SSE stack for OpenWebUI, multi-process shims, and
HTTP-based observability.

## API Overview

### Batch & Aggregation
* `/api/collect.json` - Batch helper for read-only operations (supports `disassemble_batch`, `read_words`, `search_scalars_with_context`, etc.)

### Search & Analysis
* `/api/search_strings.json` - Search for strings with pagination
* `/api/search_functions.json` - Find functions by name pattern
* `/api/search_scalars.json` - Locate scalar values in code
* `/api/search_scalars_with_context.json` - Scalars with surrounding disassembly
* `/api/search_imports.json` / `/api/search_exports.json` - Symbol search
* `/api/search_xrefs_to.json` - Cross-references to an address
* `/api/string_xrefs.json` - Compact view of string cross-references
* `/api/list_functions_in_range.json` - List functions in address range

### Memory & Disassembly
* `/api/read_bytes.json` - Read raw bytes from memory
* `/api/read_words.json` - Batch read 32-bit words
* `/api/disassemble_at.json` - Disassemble at address
* `/api/disassemble_batch.json` - Batch disassembly of multiple addresses

### Advanced Analysis
* `/api/analyze_function_complete.json` - Complete function analysis (decompile, xrefs, etc.)
* `/api/list_functions_in_range.json` - List functions in address range
* `/api/mmio_annotate.json` - Annotate MMIO accesses
* `/api/jt_scan.json` / `/api/jt_slot_check.json` / `/api/jt_slot_process.json` - Jump table analysis

### Data & Utilities
* `/api/strings_compact.json` - Bulk string listing
* `/api/string_xrefs.json` - Cross-references to strings
* `/api/write_bytes.json` - Write bytes (requires `ENABLE_WRITES`)
* `/api/project_info.json` - Project metadata
* `/api/project_rebase.json` - Project base address rebasing (writes optional)
* `/api/health.json` - Server health check

See the complete reference in [docs/api.md](docs/api.md).

## Documentation

* [Getting started](docs/getting-started.md) - Installation and configuration
* [Server operations](docs/server.md) - Running and managing the server
* [Troubleshooting](docs/troubleshooting.md) - Common issues and solutions
* [Development workflow](docs/development.md) - Contributing and `.plan/` process

## Status

This repo is maintained with a deterministic plan. See [Development](docs/development.md) for the `.plan/` workflow.

## Contributing

Contributions welcome! This is an experimental project with AI-generated code - review carefully and test thoroughly. See [Development workflow](docs/development.md) for the `.plan/` process.

## License

Apache 2.0 - See [LICENSE](LICENSE) for details.
