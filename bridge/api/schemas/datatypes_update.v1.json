{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "urn:schema:datatypes-update.v1",
  "type": "object",
  "additionalProperties": false,
  "$defs": {
    "field": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "type"],
      "properties": {
        "name": {"type": "string", "minLength": 1},
        "type": {"type": "string", "minLength": 1},
        "length": {"type": "integer", "minimum": 1},
        "offset": {"type": "integer", "minimum": 0}
      }
    }
  },
  "required": ["kind", "path", "dry_run", "written", "notes", "errors", "datatype"],
  "properties": {
    "kind": {"type": "string", "enum": ["structure", "union"]},
    "path": {"type": "string", "pattern": "^/.*"},
    "dry_run": {"type": "boolean"},
    "written": {"type": "boolean"},
    "notes": {"type": "array", "items": {"type": "string"}},
    "errors": {"type": "array", "items": {"type": "string"}},
    "transport_error": {
      "type": ["object", "null"],
      "additionalProperties": false,
      "required": ["status", "reason", "retryable"],
      "properties": {
        "status": {"type": ["integer", "null"]},
        "reason": {"type": "string"},
        "retryable": {"type": "boolean"}
      }
    },
    "datatype": {
      "type": ["object", "null"],
      "additionalProperties": false,
      "properties": {
        "kind": {"type": "string", "enum": ["structure", "union"]},
        "name": {"type": "string", "minLength": 1},
        "category": {"type": "string", "minLength": 1},
        "path": {"type": "string", "pattern": "^/.*"},
        "size": {"type": "integer", "minimum": 0},
        "fields": {
          "type": "array",
          "minItems": 1,
          "items": {"$ref": "#/$defs/field"}
        }
      },
      "required": ["kind", "path", "fields"]
    }
  }
}
